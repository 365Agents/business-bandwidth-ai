---
phase: 03-address-verification
plan: 01
type: execute
---

<objective>
Integrate Google Places Autocomplete for address entry on the landing page and quote form.

Purpose: Replace manual address entry with Google's address autocomplete, improving UX and ensuring accurate address data for carrier quotes.
Output: Working address autocomplete on landing page and quote form with automatic field population.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-lead-capture/02-01-SUMMARY.md

**Tech available:**
- shadcn/ui components (Input, Form, etc.)
- React Hook Form with zod validation
- Next.js 16 App Router

**Key files:**
- src/components/address-input.tsx (landing page input)
- src/app/quote/page.tsx (quote form with address fields)
- src/lib/validations/quote.ts (zod schema)

**Prior decisions:**
- Google-style address input on landing page
- Single-page quote form
- Address passed via query params from landing → quote

**Google Places API approach:**
- Use @react-google-maps/api library (official Google-supported React wrapper)
- Autocomplete component with session tokens for billing optimization
- Parse place details to extract street, city, state, zip automatically
- Restrict to US addresses (country filter)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Google Maps library and create autocomplete component</name>
  <files>package.json, src/components/google-address-autocomplete.tsx, src/lib/google-maps.tsx</files>
  <action>
1. Install @react-google-maps/api:
   `npm install @react-google-maps/api`

2. Create src/lib/google-maps.tsx - Provider wrapper:
   - Export GoogleMapsProvider component using LoadScript
   - Load only "places" library (not full maps)
   - Get API key from NEXT_PUBLIC_GOOGLE_MAPS_API_KEY env var
   - Handle loading/error states

3. Create src/components/google-address-autocomplete.tsx:
   - Use Autocomplete component from @react-google-maps/api
   - Props: value, onChange, onPlaceSelect, placeholder, className
   - onPlaceSelect callback returns parsed address: { streetAddress, city, state, zipCode, placeId, formattedAddress }
   - Parse address_components from place details:
     - street_number + route → streetAddress
     - locality → city
     - administrative_area_level_1 (short_name) → state
     - postal_code → zipCode
   - Restrict to US addresses: componentRestrictions={{ country: "us" }}
   - Use types: ["address"] to get street addresses (not establishments yet)
   - Style to match existing Input component (shadcn styling)

4. Add .env.example entry for NEXT_PUBLIC_GOOGLE_MAPS_API_KEY
  </action>
  <verify>Component renders without errors when API key is set</verify>
  <done>GoogleAddressAutocomplete component exists, handles place selection, parses address components</done>
</task>

<task type="auto">
  <name>Task 2: Integrate autocomplete into landing page and quote form</name>
  <files>src/app/layout.tsx, src/components/address-input.tsx, src/app/quote/page.tsx</files>
  <action>
1. Update src/app/layout.tsx:
   - Wrap children with GoogleMapsProvider
   - Only load if API key exists (graceful fallback)

2. Update src/components/address-input.tsx (landing page):
   - Replace plain Input with GoogleAddressAutocomplete
   - On place select, encode full address and redirect to /quote with all components as query params
   - Query params: ?street=...&city=...&state=...&zip=...&formatted=...
   - Keep the existing Google-style visual design (rounded, shadow, icon)
   - Fallback to plain input if Google Maps not loaded

3. Update src/app/quote/page.tsx:
   - Read all address query params (street, city, state, zip)
   - Pre-fill ALL address fields from query params (not just streetAddress)
   - Replace streetAddress Input with GoogleAddressAutocomplete
   - On place select in form, auto-fill city, state, zipCode fields
   - Keep manual fields editable for corrections
   - Show "Verified" badge next to address if from Google autocomplete

Note: Don't break existing flow - if no Google API key, fall back to manual entry.
  </action>
  <verify>
    1. Landing page shows autocomplete dropdown when typing address
    2. Selecting address redirects to /quote with all fields pre-filled
    3. Quote form shows autocomplete with auto-fill for city/state/zip
  </verify>
  <done>Address autocomplete works on landing page and quote form, fields auto-populate</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Google Places address autocomplete on landing page and quote form</what-built>
  <how-to-verify>
    1. Add your Google Maps API key to .env.local: NEXT_PUBLIC_GOOGLE_MAPS_API_KEY=your_key
    2. Run: npm run dev
    3. Visit: http://localhost:3000
    4. Type a business address (e.g., "1600 Amphitheatre") in landing page input
    5. Verify: Dropdown appears with address suggestions
    6. Select an address
    7. Verify: Redirected to /quote with all address fields pre-filled
    8. On quote form, try typing new address in street field
    9. Verify: Autocomplete appears, selecting fills city/state/zip
    10. Submit form to verify it still works
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run lint` passes
- [ ] `npx tsc --noEmit` passes
- [ ] Address autocomplete shows suggestions
- [ ] Selecting address populates all fields
- [ ] Fallback works when API key not set
</verification>

<success_criteria>
- Google Places Autocomplete integrated
- Landing page and quote form both use autocomplete
- Address components parsed and auto-filled
- Graceful fallback for missing API key
- Human verified autocomplete UX
</success_criteria>

<output>
After completion, create `.planning/phases/03-address-verification/03-01-SUMMARY.md`
</output>

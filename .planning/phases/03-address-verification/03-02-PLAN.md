---
phase: 03-address-verification
plan: 02
type: execute
---

<objective>
Add business address validation to filter out residential addresses and ensure B2B focus.

Purpose: The platform targets business internet circuits - residential addresses should be flagged or warned, maintaining lead quality.
Output: Business validation indicator, warning for residential addresses, optional establishment search.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-address-verification/03-01-SUMMARY.md

**Tech available:**
- @react-google-maps/api with Places Autocomplete
- GoogleAddressAutocomplete component (from 03-01)
- shadcn/ui components

**From 03-01:**
- Address autocomplete working on landing page and quote form
- Place details available with placeId

**Business validation approach:**
Google Places returns `types` array for each place. Key types:
- "establishment" - business locations
- "street_address" - could be residential or commercial
- "premise" - building (could be either)
- "subpremise" - unit within building

Strategy:
1. If types includes "establishment" → definitely business, show green badge
2. If types is only "street_address" or "premise" → ambiguous, show warning
3. Offer establishment search mode for finding businesses by name
4. Store address type with quote for future analytics
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add address type detection and business validation</name>
  <files>src/components/google-address-autocomplete.tsx, src/lib/validations/quote.ts, prisma/schema.prisma</files>
  <action>
1. Update GoogleAddressAutocomplete onPlaceSelect callback:
   - Include `types` array from place details
   - Add `isEstablishment` boolean: types.includes("establishment")
   - Add `addressType` string: "business" | "residential" | "unknown"
   - Logic:
     - If types includes "establishment" → "business"
     - If types includes "street_address" without establishment → "unknown"
     - Default to "unknown" (not blocking, just informational)

2. Update component to show validation badge:
   - After address selected, show inline badge:
     - Green "Business" badge if addressType === "business"
     - Yellow "Verify" badge if addressType === "unknown"
   - Badge appears next to the input, not intrusive

3. Update zod schema (src/lib/validations/quote.ts):
   - Add optional `addressType` field: z.enum(["business", "residential", "unknown"]).optional()
   - Add optional `placeId` field: z.string().optional()

4. Update Prisma schema (prisma/schema.prisma):
   - Add to Quote model:
     - addressType String? (for analytics)
     - placeId String? (for future lookups)
   - Run: npx prisma db push

5. Update server action (src/app/quote/actions.ts):
   - Accept and store addressType and placeId with quote
  </action>
  <verify>Selecting business shows green badge, selecting street address shows yellow badge</verify>
  <done>Address type detection works, badges display, data stored with quote</done>
</task>

<task type="auto">
  <name>Task 2: Add residential address warning and establishment search option</name>
  <files>src/app/quote/page.tsx, src/components/google-address-autocomplete.tsx</files>
  <action>
1. Update quote form to show warning for unknown address types:
   - If addressType is "unknown" after selection, show info banner:
     "This appears to be a residential address. Business internet quotes are for commercial locations. You can still submit, but pricing may differ."
   - Use shadcn Alert component with info variant
   - Don't block submission - just inform

2. Add establishment search toggle to GoogleAddressAutocomplete:
   - Add prop `searchMode`: "address" | "establishment" (default: "address")
   - When searchMode is "establishment":
     - Use types: ["establishment"] instead of ["address"]
     - This searches by business name
   - Add toggle button/link below address input:
     "Can't find your business? Search by business name"
   - Clicking toggles to establishment mode

3. Update landing page to support both modes:
   - Default: address search
   - Link to switch: "Search by business name instead"
   - When in establishment mode, show "Search by address" to switch back

4. When establishment is selected:
   - Auto-fill address from place details
   - Show company name suggestion if available (place.name)
  </action>
  <verify>
    1. Selecting residential-looking address shows warning
    2. Toggle to business search mode works
    3. Finding business by name auto-fills address
  </verify>
  <done>Residential warning displays, establishment search mode available</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Business address validation with warnings and establishment search</what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. Visit: http://localhost:3000
    3. Type a known business address (e.g., "Starbucks Austin")
    4. Verify: Green "Business" badge appears after selection
    5. Type a residential address (e.g., "123 Oak Street Austin TX")
    6. Verify: Yellow "Verify" badge appears
    7. Go to quote form, select the residential address
    8. Verify: Warning banner appears about residential address
    9. Click "Search by business name" toggle
    10. Verify: Search mode changes, can find businesses by name
    11. Select a business, verify address and company name populate
    12. Submit a quote, check database for addressType field
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run lint` passes
- [ ] `npx tsc --noEmit` passes
- [ ] `npx prisma db push` succeeds
- [ ] Business addresses show green badge
- [ ] Unknown addresses show yellow badge + warning
- [ ] Establishment search finds businesses
- [ ] addressType stored in database
</verification>

<success_criteria>
- Address type detection working
- Visual badges indicate business vs unknown
- Warning displayed for non-business addresses
- Establishment search mode available
- Data persisted for analytics
- Phase 3 complete
</success_criteria>

<output>
After completion, create `.planning/phases/03-address-verification/03-02-SUMMARY.md`

Note: This completes Phase 3. Update STATE.md to reflect Phase 3 complete, ready for Phase 4.
</output>

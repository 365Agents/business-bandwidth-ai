---
phase: 02-lead-capture
plan: 02
type: execute
---

<objective>
Update dashboard to display real lead and quote data with basic management.

Purpose: Make the dashboard functional with actual data from the database, showing leads and quotes.
Output: Working dashboard with lead/quote counts, recent quotes list, and quote detail view.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-lead-capture/02-01-SUMMARY.md

**Tech available:**
- Prisma with Lead and Quote models
- shadcn/ui Table, Card, Badge components
- Next.js Server Components for data fetching

**From 02-01:**
- Quote submission creates Lead + Quote records
- Status field tracks quote lifecycle (pending, processing, complete, failed)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create data fetching functions</name>
  <files>src/lib/queries/leads.ts, src/lib/queries/quotes.ts</files>
  <action>
1. Create src/lib/queries/leads.ts:
```typescript
import { db } from "@/lib/db"

export async function getLeadCount() {
  return db.lead.count()
}

export async function getRecentLeads(limit = 10) {
  return db.lead.findMany({
    take: limit,
    orderBy: { createdAt: "desc" },
    include: { quotes: true },
  })
}

export async function getLeadById(id: string) {
  return db.lead.findUnique({
    where: { id },
    include: { quotes: true },
  })
}
```

2. Create src/lib/queries/quotes.ts:
```typescript
import { db } from "@/lib/db"

export async function getQuoteCount() {
  return db.quote.count()
}

export async function getPendingQuoteCount() {
  return db.quote.count({ where: { status: "pending" } })
}

export async function getRecentQuotes(limit = 10) {
  return db.quote.findMany({
    take: limit,
    orderBy: { createdAt: "desc" },
    include: { lead: true },
  })
}

export async function getQuoteById(id: string) {
  return db.quote.findUnique({
    where: { id },
    include: { lead: true },
  })
}
```
  </action>
  <verify>Functions compile without TypeScript errors</verify>
  <done>Data fetching functions created for leads and quotes</done>
</task>

<task type="auto">
  <name>Task 2: Update dashboard with real data</name>
  <files>src/app/dashboard/page.tsx</files>
  <action>
1. Update src/app/dashboard/page.tsx as a Server Component:
- Fetch real counts using getLeadCount, getQuoteCount, getPendingQuoteCount
- Fetch recent quotes using getRecentQuotes
- Display stats in the existing card layout
- Add a table showing recent quotes with columns:
  - Company (from lead)
  - Location (city, state)
  - Speed
  - Status (with Badge: pending=yellow, processing=blue, complete=green, failed=red)
  - Date (formatted)
- If no quotes, show the existing empty state
- Link each row to /dashboard/quotes/[id] (placeholder for now)

2. Format dates nicely (e.g., "Jan 12, 2026")
3. Use proper status badge colors
  </action>
  <verify>Dashboard shows real counts and quote list, refreshes when new quotes added</verify>
  <done>Dashboard displays real lead/quote data with recent quotes table</done>
</task>

<task type="auto">
  <name>Task 3: Create quote detail page</name>
  <files>src/app/dashboard/quotes/[id]/page.tsx</files>
  <action>
1. Create src/app/dashboard/quotes/[id]/page.tsx:
- Fetch quote by ID with lead info
- Display all quote details in a clean Card layout:
  - Contact info section (name, email, phone, company)
  - Location section (full address)
  - Service section (speed, term)
  - Status section with Badge
  - Pricing section (MRC, NRC) — show "Pending" if not yet available
  - Timestamps (created, updated)
- Back button to /dashboard
- If quote not found, show 404-style message

2. This page will be enhanced in Phase 4 when we add real Momentum API pricing.
  </action>
  <verify>Quote detail page renders with all information for a submitted quote</verify>
  <done>Quote detail page shows full quote information</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete lead capture flow: form → database → dashboard</what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. Visit: http://localhost:3000
    3. Click the address input or "Get Quote" button
    4. Fill out the form with test data:
       - Name: Test User
       - Email: test@example.com
       - Phone: 555-123-4567
       - Company: Test Corp
       - Address: 123 Main St, Austin, TX 78701
       - Speed: 1 Gbps
       - Term: 36 months
    5. Submit the form
    6. Verify: Success toast appears
    7. Click: Dashboard in navigation
    8. Verify: Stats show 1 lead, 1 quote, 1 pending
    9. Verify: Recent quotes table shows the submission
    10. Click: The quote row
    11. Verify: Quote detail page shows all submitted info
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] Dashboard shows real data from database
- [ ] Quote detail page displays all quote information
- [ ] Full flow tested: form → submit → dashboard → detail
</verification>

<success_criteria>
- Dashboard displays real lead and quote counts
- Recent quotes table shows submitted quotes
- Quote detail page shows full quote information
- Complete lead capture flow works end-to-end
- Human verified the entire flow
- Phase 2 complete
</success_criteria>

<output>
After completion, create `.planning/phases/02-lead-capture/02-02-SUMMARY.md`

Note: This completes Phase 2. Update STATE.md to reflect Phase 2 complete, ready for Phase 3.
</output>
